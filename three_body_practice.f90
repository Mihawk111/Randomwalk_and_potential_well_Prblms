program three_body
real*8::X(12),F(12),t,h,a,b
integer::N,n_step
open(102,file="damped_pendulum_practice.dat",status="unknown")
N=12
X(1)=-1.0
X(2)=0.0
X(3)=3.0
X(4)=0.0
X(5)=2.0
x(6)=0.0
X(7)=-1.0
X(8)=0.0
X(9)=-1.0
X(10)=0.0
X(11)=-1.0
X(12)=0.0
a=0.0;b=10.0
n_step=1000000
h=(b-a)/n_step
t=0.0
call RK4SYS(N,t,X,h,n_step)
end program three_body


 SUBROUTINE XPSYS(X,F) 
      real*8::X(12),F(12),omega,beta,M(3)
      m(1)=3.0;M(2)=4.0;M(3)=5.0 
      F(1) = X(2)
      F(2) = -((M(2)*(X(1)-X(5)))/(((X(1)-X(5))**2+(X(3)-X(7))**2)**(1.5)))
      F(2) = F(2)-((M(3)*(X(1)-X(9)))/(((X(1)-X(9))**2+(X(3)-X(11))**2)**(1.5)))
          !  -  M(2)*(X(1)-X(5)) / ((X(1)-X(5))**2+(X(3)-X(7))**2)**(1.5)  -  M(3)*(X(1)-X(9)) / ((X(1)-X(9))**2+(X(3)-X(11))**2)**(1.5)
          ! -((M(2)*(X(1)-X(5)))/(((X(1)-X(5))**2+(X(3)-X(7))**2)**(1.5)))-((M(3)*(X(1)-X(9)))/(((X(1)-X(9))**2+(X(3)-X(11))**2)**(1.5)))
      F(3)=X(4)
      F(4)=-((M(2)*(X(3)-X(7)))/(((X(1)-X(5))**2+(X(3)-X(7))**2)**1.5))
      F(4)=F(4)-((M(3)*(X(3)-X(11)))/(((X(1)-X(9))**2+(X(3)-X(11))**2)**1.5))
     F(5)=X(6)
     F(6)=-((M(3)*(X(5)-X(9)))/(((X(5)-X(9))**2+(X(7)-X(11))**2)**1.5))
     F(6)=F(6)-((M(1)*(X(5)-X(1)))/(((X(5)-X(1))**2+(X(7)-X(3))**2)**1.5))
     F(7)=X(8)
     F(8)=-((M(3)*(X(7)-X(11)))/(((X(5)-X(9))**2+(X(7)-X(11))**2)**1.5))
     F(8)=F(8)-((M(1)*(X(7)-X(3)))/(((X(5)-X(1))**2+(X(7)-X(3))**2)**1.5))
     F(9)=X(10)
     F(10)=-((M(1)*(X(9)-X(1)))/(((X(9)-X(1))**2+(X(11)-X(3))**2)**1.5))
     F(10)=F(10)-((M(2)*(X(9)-X(5)))/(((X(9)-X(5))**2+(X(11)-X(7))**2)**1.5))
     F(11)=X(12)
     F(12)=-((M(1)*(X(11)-X(3)))/(((X(9)-X(1))**2+(X(11)-X(3))**2)**1.5))
     F(12)=F(12)-((M(2)*(X(11)-X(7)))/(((X(9)-X(5))**2+(X(11)-X(7))**2)**1.5))
      RETURN
      END 

      SUBROUTINE RK4SYS(N,T,X,H,NSTEP)
      real*8::X(12),Y(12),F1(12),F2(12),F3(12),F4(12)
      real*8::H,H2,START,T
      integer::NSTEP,N,K  
      write(102,*)T,(X(I),I=1,N)
      H2 = 0.5*H  
      START = T   
      DO 6 K = 1,NSTEP      
        CALL XPSYS(X,F1)    
        DO 2 I = 1,N
          Y(I) = X(I) + H2*F1(I)      
   2    CONTINUE
        CALL XPSYS(Y,F2)    
        DO 3 I = 1,N
          Y(I) = X(I) + H2*F2(I)      
   3    CONTINUE
        CALL XPSYS(Y,F3)    
        DO 4 I = 1,N
          Y(I) = X(I) + H*F3(I)       
   4    CONTINUE
        CALL XPSYS(Y,F4)    
        DO 5 I = 1,N
          X(I) = X(I) + H*(F1(I) + 2.0*(F2(I) + F3(I)) + F4(I))/6.0 
   5    CONTINUE
        T = START + REAL(K)*H 
       write(102,*)T,(X(I),I=1,N)      
   6  CONTINUE
        
   !7  FORMAT(2X,'T,X:',E10.3,5(2X,E22.14))
      RETURN      
      END 
